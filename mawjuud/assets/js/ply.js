!function(t){"use strict";"function"==typeof define&&define.amd?define(t):window.Ply=t()}(function(){"use strict";var o,r,t,a,i=1,y=function(){},e=window,l=e.document,c=e.setTimeout,s={ok:"OK",cancel:"Cancel",cross:"âœ–"},f=(o={},r=l.createElement("div").style,t="opacity transition transform perspective transformStyle transformOrigin backfaceVisibility".split(" "),a=["Webkit","Moz","O","MS"],_(t,function(t,e){if(o[t]=t in r&&t,!o[t])for(e=0;e<4;e++){var n=a[e]+t.charAt(0).toUpperCase()+t.substr(1);if(o[t]=n in r&&n)break}}),o),n={esc:27},u="data-ply",d=window.jQuery||window.Zepto||window.ender||window.$,p={clone:!0,zIndex:1e4,rootTag:"form",baseHtml:!0,layer:{},wrapper:{},overlay:{opacity:.6,backgroundColor:"rgb(0, 0, 0)"},flags:{closeBtn:!0,bodyScroll:!1,closeByEsc:!0,closeByOverlay:!0,hideLayerInStack:!0,visibleOverlayInStack:!1},oninit:y,onopen:y,onclose:y,ondestroy:y,onaction:y},h=window.Promise,v=window.Deferred||h;function g(t){if(v)return new v(t);var e=d.Deferred();return t(e.resolve,e.reject),e}function m(t){return v?v.all(t):d.when.apply(d,t)}function E(e){return g(function(t){return t(e)})}var w=E();function b(t){return"function"==typeof t}function _(t,e){if(t)for(var n in t)t.hasOwnProperty(n)&&e(t[n],n,t)}function x(t){var n={};return _(t,function(t,e){b(t)?n[e]=t:t instanceof Object?n[e]=x(t):n[e]=t}),n}function k(n){for(var t=Array.prototype.slice.call(arguments,1),e=0,o=t.length;e<o;e++)_(t[e],function(t,e){n[e]=t});return n}h&&!w.always&&((v=function(t){var e=new h(t);return e.__proto__=this.__proto__,e}).prototype=Object.create(h.prototype),(v.prototype.constructor=v).prototype.then=function(t,e){var n=h.prototype.then.call(this,t,e);return n.__proto__=this.__proto__,n},v.prototype.done=function(t){return this.then(t),this},v.prototype.fail=function(t){return this.catch(t),this},v.prototype.always=function(t){return this.then(t,t),this},["all","cast","reject","resolve"].forEach(function(t){v[t]=h[t]}));var S=/^(\w+)?(#\w+)?((?:\.[\w_-]+)*)/i;function N(e,n){try{return(n||l).querySelector(e)}catch(t){return d(e,n)[0]}}function C(t,e){return t.getElementsByTagName(e)}function O(t,e){try{t&&e&&t.appendChild(e)}catch(t){}}function A(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function B(e,t,n){var o=n.handle=n.handle||function(t){t.target||(t.target=t.srcElement||l),3===t.target.nodeType&&(t.target=t.target.parentNode),t.preventDefault||(t.preventDefault=function(){t.returnValue=!1}),t.stopPropagation||(t.stopPropagation=function(){t.cancelBubble=!0}),n.call(e,t)};e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent("on"+t,o)}function j(t,e,n){var o=n.handle;o&&(t.removeEventListener?t.removeEventListener(e,o,!1):t.detachEvent("on"+e,o))}function T(t){if(null==t&&(t="div"),t.appendChild)return t;if(t.skip)return l.createDocumentFragment();"string"==typeof t&&(t={tag:t});var o,e=t.children,n=S.exec(t.tag||"");return delete t.children,t.tag=n[1]||"div",t.id=t.id||(n[2]||"").substr(1),(n=(n[3]||"").split("."))[0]=t.className||"",t.className=n.join(" "),o=l.createElement(t.tag),delete t.tag,_(t,function(e,n){if(e)if("css"===n)q(o,t.css);else if("text"===n)null!=e&&O(o,l.createTextNode(e));else if("html"===n)null!=e&&(o.innerHTML=e);else if("ply"===n)o.setAttribute(u,e);else if(n in o)try{o[n]=e}catch(t){o.setAttribute(n,e)}else/^data-/.test(n)&&o.setAttribute(n,e)}),e&&e.appendChild?O(o,e):_(e,function(t,e){t&&("string"==typeof t?t={text:t}:"object"!=typeof t&&(t={}),"string"==typeof e&&(t.tag=t.tag||e),O(o,T(t)))}),o}function I(t){for(var e,n,o=C(t,"input"),r=0,a=o.length;r<a;r++)if("submit"===(e=o[r]).type)!n&&(n=e);else if(!/hidden|check|radio/.test(e.type)&&""==e.value){n=e;break}n||(n=C(t,"button")[0]);try{n.focus()}catch(t){}}function F(i){return D(!0),g(function(t){for(var e,n=C(i,"img"),o=n.length,r=o,a=function(){if(--r<=0){for(o=n.length;o--;)j(e=n[o],"load",a),j(e,"error",a);D(!1),t()}};o--;)(e=n[o]).complete?r--:(B(e,"load",a),B(e,"error",a));!r&&a()})}var $={opacity:!f.opacity&&function(t,e){t.zoom=1,t.filter="alpha(opacity="+100*e+")"}};function q(t,e,n){if(t&&t.style&&e)if(e instanceof Object)for(var o in e)q(t,o,e[o]);else{if(void 0===n)return l.defaultView&&l.defaultView.getComputedStyle?n=l.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];$[e]?$[e](t.style,n):t.style[f[e]||e]=n}}function D(t){var e=D.get();clearTimeout(D.pid),D.pid=c(t?function(){O(l.body,e)}:function(){A(e)},100)}function L(t,e,n){t.wrapEl=T({tag:e.rootTag,css:{whiteSpace:"nowrap",zIndex:e.zIndex},method:"post",action:"/"}),n||(t.overlayEl=T({ply:":overlay",tag:".ply-overlay",css:{top:0,left:0,right:0,bottom:0,position:"fixed"},children:[{tag:"div",css:k({width:"100%",height:"100%"},e.overlay)}]}),t.overlayBoxEl=t.overlayEl.firstChild,O(t.wrapEl,t.overlayEl));var o=T();q(o,{height:"100%",display:"inline-block",verticalAlign:"middle"}),O(t.wrapEl,o);var r,a,i=e.el;return t.el=i&&i.cloneNode?e.clone?i.cloneNode(!0):i:T({html:i||""}),t.layerEl=(r=t.el,T({css:k({padding:"20px 20px 40px",display:"inline-block",position:"relative",textAlign:"left",whiteSpace:"normal",verticalAlign:"middle",transform:"translate3d(0, 0, 0)"},(a=e).wrapper),children:a.baseHtml?[{ply:":layer",tag:".ply-layer",className:a.mod,css:k({overflow:"hidden",position:"relative",backfaceVisibility:"hidden"},a.layer),children:[a.flags.closeBtn&&{ply:":close",tag:".ply-x",text:s.cross},{tag:".ply-inside",children:r}]}]:r})),t.contentEl=X(t.layerEl),t.context=new V(t.layerEl),O(t.wrapEl,t.layerEl),t.bodyEl=e.body&&N(e.body)||l.body,t.wrapEl.tabIndex=-1,q(t.wrapEl,{top:0,left:0,right:0,bottom:0,position:"fixed",textAlign:"center",overflow:"auto",outline:0}),t}function X(t){return t.firstChild.lastChild.firstChild}function H(t,e){(e=t instanceof Object?t:e||{}).el=e.el||t;var n=this;n.cid="c"+i++,p.zIndex++,n.options=e=k({},p,e),e.flags=k({},p.flags,e.flags),L(n,e),n.setEffect(e.effect),n.fx=function(t){return!(n.fx.queue=n.fx.queue.then(t,t).then(function(){return n}))},n.fx.queue=E(),n.on("click",":overlay",function(){n.hasFlag("closeByOverlay")&&n.closeBy("overlay")}),n.on("click",":close",function(t,e){t.preventDefault(),n.closeBy("BUTTON"===e.nodeName?"cancel":"x")}),n.options.oninit(this)}D.get=function(){return D.el||(D.el=T({tag:".ply-global-loading",children:{".ply-loading-spinner":!0}}))},H.fn=H.prototype={constructor:H,_activate:function(){if(!this.hasFlag("bodyScroll")){var t=this.bodyEl,e=T({css:{overflow:"auto",visibility:"hidden",height:"5px"},children:[{tag:"div",css:{height:"100px"}}]});this.__overflow=q(t,"overflow"),this.__paddingRight=q(t,"paddingRight"),O(t,e),q(t,{overflow:"hidden",paddingRight:e.offsetWidth-e.firstChild.offsetWidth+"px"}),A(e)}B(this.wrapEl,"submit",this._getHandleEvent("submit"))},_deactivate:function(){this.hasFlag("bodyScroll")||q(this.bodyEl,{overflow:this.__overflow,paddingRight:this.__paddingRight}),j(this.layerEl,"submit",this._getHandleEvent("submit"))},_getHandleEvent:function(e){var n=this,t=n.__handleEvent||(n.__handleEvent={});return t[e]||(t[e]=function(t){n._handleEvent(e,t)}),t[e]},_handleEvent:function(t,e){e.preventDefault(),this.closeBy(t)},$:function(t){return d(t,this.layerEl)},find:function(t){return N(t,this.layerEl)},applyEffect:function(t,e,n){return(t=this[t]||t).nodeType||(n=e,e=t,t=this.layerEl),n=H.effects.get(n||this.effects),H.effects.apply.call(n,t,e)},closeBy:function(t){var e,n=this,o={by:t,state:"submit"===t,data:this.context.toJSON(),widget:this,context:this.context},r=(this.el,this.options.onaction(o));this.__lock||(this.__lock=!0,this.el.className+=" ply-loading",(e=r,e&&e.then?e:E(e)).done(function(t){!1!==t&&(n.result=o,n.close())}).always(function(){n.__lock=!1,n.el.className=n.el.className.replace(/\s?ply-loading/,"")}))},on:function(t,n,o){var r=this;return o||(o=n,n=":layer"),o["_"+n]=function(t){var e=t.target;do{if(1===e.nodeType&&e.getAttribute(u)===n)return o.call(r,t,e)}while(e!==r.wrapEl&&(e=e.parentNode))},B(r.wrapEl,t,o["_"+n]),r},off:function(t,e,n){return n||(n=e,e="layer"),j(this.wrapEl,t,n["_"+e]||y),this},hasFlag:function(t){return!!this.options.flags[t]},setEffect:function(t){return this.effects=H.effects.get(t),this},_toggleState:function(o,r){var a=this,i=o?"open":"close",l=H.stack.last;return a.visible!=o&&(a.visible=o,a[o?"_activate":"_deactivate"](),H.stack[o?"add":"remove"](a),a.fx(function(){return F(a.wrapEl).then(function(){var t=H.stack.length===(o?1:0),e=l&&l.hasFlag("hideLayerInStack"),n=t||a.hasFlag("visibleOverlayInStack");return o?(!n&&A(a.overlayBoxEl),O(a.bodyEl,a.wrapEl),a.wrapEl.focus(),I(a.layerEl),e&&l.applyEffect("close.layer",r).then(function(){A(l.layerEl)})):(l=H.stack.last)&&(O(l.wrapEl,l.layerEl),l.hasFlag("hideLayerInStack")&&l.applyEffect("open.layer",r).then(function(){I(l.el)})),m([a.applyEffect(i+".layer",r),n&&a.applyEffect("overlayEl",i+".overlay",r)]).then(function(){o||(A(a.wrapEl),O(a.overlayEl,a.overlayBoxEl)),a.options["on"+i](a)})})})),a.fx.queue},open:function(t){return this.result=null,this._toggleState(!0,t)},close:function(t){return this._toggleState(!1,t)},_swap:function(t,e,n,o,r){var a=this;return a.visible?a.fx(function(){return F(e).then(function(){return o(),m([a.applyEffect(t,"close.layer",n),a.applyEffect(e,"open.layer",n)]).then(function(){A(t),r(),a.wrapEl.focus(),I(e)})})}):r(),a.fx.queue},swap:function(t,e){t=k({},this.options,t);var n=this,o=L({},t,!0),r=e||t.effect?H.effects.get(e||t.effect):n.effects,a=n.layerEl,i=o.layerEl;return n._swap(a,i,r,function(){O(n.bodyEl,n.wrapEl),O(n.bodyEl,o.wrapEl)},function(){A(o.wrapEl),O(n.wrapEl,i),n.el=o.el,n.layerEl=i,n.contentEl=X(i),n.context.el=i})},innerSwap:function(t,e){var n=L({},t=k({},this.options,t),!0),o=e||t.effect?H.effects.get(e||t.effect):this.effects,r=N(".ply-inside",n.layerEl),a=N(".ply-inside",this.layerEl);return this._swap(a,r,o,function(){q(a,{width:a.offsetWidth+"px",position:"absolute"}),O(a.parentNode,r)},y)},destroy:function(){A(this.wrapEl),this._deactivate(),H.stack.remove(this),this.visible=!1,this.options.ondestroy(this)}};var Y=[],z=Y.push,P=Y.splice;function V(t){this.el=t}function J(t){return t&&t.appendChild}function R(t,e){return null==t?{skip:!0}:("string"==typeof t&&(t={text:t}),"object"==typeof t&&(t.name=t.name||e),t)}function W(t,e,n){var o,r=W[t];return r||(t=t.split(/\s+/).slice(0,-1).join(" "),r=e&&(W[t+" [name="+e.name+"]"]||W[t+" [type="+e.type+"]"])||W[t+" *"]||W[":default"]),o=T(r(e,n)),e&&e.name&&o.setAttribute(u+"-name",e.name),o.className+=" ply-ui",o}function M(t,r){M["_"+t]=r,M[t]=function(n,o){return g(function(t,e){r(n,o,t,e)}).then(function(t){return J(t)||(t=W(":root",t)),t})}}function U(t,e,n,o){return e.mod=t,e.effect=e.effect||"slide",e.flags=k({closeBtn:!1},e.flags),{header:n.title,content:n.form?{"dialog-form":{children:n.form}}:{el:n.text||n},ctrls:{ok:n.ok||o.ok,cancel:!1===n.cancel?null:n.cancel||o.cancel}}}return H.stack={_idx:{},last:null,length:0,_pop:function(t){var e=H.stack.last;t.keyCode===n.esc&&e.hasFlag("closeByEsc")&&e.closeBy("esc")},add:function(t){var e=z.call(this,t);this.last=t,this._idx[t.cid]=e-1,1===e&&B(l,"keyup",this._pop)},remove:function(t){var e=this._idx[t.cid];0<=e&&(P.call(this,e,1),delete this._idx[t.cid],this.last=this[this.length-1],this.last||j(l,"keyup",this._pop))}},(H.effects={defaults:{duration:300,open:{layer:null,overlay:null},close:{layer:null,overlay:null}},setup:function(t){this.defaults=this.get(t)},set:function(t){k(this,t)},get:function(i){var t=x(this.defaults);function l(t){var e=/^([\w_-]+)(?::(\d+%?))?(\[[^\]]+\])?/.exec(t)||[];return{name:e[1]||t,duration:e[2]||null,args:JSON.parse(e[3]||"null")||{}}}function e(t,e,n){var o=l(e),r=t[o.name]||n||{},a=o.duration||r.duration||t.duration||i.duration;return"string"==typeof r&&delete(r=l(r)).args,/%/.test(r.duration)&&(r.duration=parseInt(r.duration,10)/100*a),r.duration=0|(r.duration||a),r}if("string"==typeof i){var n=l(i);(i=x(this[n.name]||{open:{},close:{}})).duration=n.duration||i.duration,i.open.args=n.args[0],i.close.args=n.args[1]}else if(i instanceof Array){var o=l(i[0]),r=l(i[1]),a=this[o.name],c=this[r.name];(i={open:x(a&&a.open||{layer:i[0],overlay:i[0]}),close:x(c&&c.close||{layer:i[1],overlay:i[1]})}).open.args=o.args[0],i.close.args=r.args[0]}else i instanceof Object||(i={});for(var s in i.duration=0|(i.duration||t.duration),{open:0,close:0}){var f=i[s]||t[s]||{};"string"==typeof f&&(f={layer:f}),f.layer=e(f,"layer",t[s].layer),f.overlay=e(f,"overlay",t[s].overlay),void 0===f.args&&delete f.args,i[s]=f}return i},apply:function(o,t){var e,n,r=this[(t=t.split("."))[0]],a=o.firstChild,i=[o.getAttribute("style"),a&&a.getAttribute("style")];return f.transition&&r&&(n=r[t[1]])&&(e=H.effects[n.name])&&(e.to||e.from)?(e=x(e),q(o,"transition","none"),q(a,"transition","none"),_(e.to,function(t,e,n){"&"===t&&(n[e]=q(o,e))}),b(e.from)?e.from(o,r.args):e.from&&q(o,e.from),g(function(t){e.width=o.offsetWidth,q(o,"transition","all "+n.duration+"ms"),q(a,"transition","all "+n.duration+"ms"),b(e.to)?e.to(o,r.args):q(o,e.to),c(t,n.duration)}).then(function(){o.setAttribute("style",i[0]),a&&a.setAttribute("style",i[1])})):E()}}).set({fade:{open:{layer:"fade-in:80%",overlay:"fade-in:100%"},close:{layer:"fade-out:60%",overlay:"fade-out:60%"}},scale:{open:{layer:"scale-in",overlay:"fade-in"},close:{layer:"scale-out",overlay:"fade-out"}},fall:{open:{layer:"fall-in",overlay:"fade-in"},close:{layer:"fall-out",overlay:"fade-out"}},slide:{open:{layer:"slide-in",overlay:"fade-in"},close:{layer:"slide-out",overlay:"fade-out"}},"3d-flip":{open:{layer:"3d-flip-in",overlay:"fade-in"},close:{layer:"3d-flip-out",overlay:"fade-out"}},"3d-sign":{open:{layer:"3d-sign-in",overlay:"fade-in"},close:{layer:"3d-sign-out",overlay:"fade-out"}},inner:{open:{layer:"inner-in"},close:{layer:"inner-out"}},"fade-in":{from:{opacity:0},to:{opacity:"&"}},"fade-out":{to:{opacity:0}},"slide-in":{from:{opacity:0,transform:"translateY(20%)"},to:{opacity:"&",transform:"translateY(0)"}},"slide-out":{to:{opacity:0,transform:"translateY(20%)"}},"fall-in":{from:{opacity:0,transform:"scale(1.3)"},to:{opacity:"&",transform:"scale(1)"}},"fall-out":{to:{opacity:0,transform:"scale(1.3)"}},"scale-in":{from:{opacity:0,transform:"scale(0.7)"},to:{opacity:"&",transform:"scale(1)"}},"scale-out":{to:{opacity:0,transform:"scale(0.7)"}},rotate3d:function(t,e,n,o,r){q(t,{perspective:"1300px"}),q(t.firstChild,{opacity:e,transform:"rotate"+n+"("+o+"deg)",transformStyle:"preserve-3d",transformOrigin:r?"50% 0":"50%"})},"3d-sign-in":{from:function(t){H.effects.rotate3d(t,0,"X",-60,"50% 0")},to:function(t){q(t.firstChild,{opacity:1,transform:"rotateX(0)"})}},"3d-sign-out":{from:function(t){H.effects.rotate3d(t,1,"X",0,"50% 0")},to:function(t){q(t.firstChild,{opacity:0,transform:"rotateX(-60deg)"})}},"3d-flip-in":{from:function(t,e){H.effects.rotate3d(t,0,"Y",e||-70)},to:function(t){q(t.firstChild,{opacity:1,transform:"rotateY(0)"})}},"3d-flip-out":{from:function(t){H.effects.rotate3d(t,1,"Y",0)},to:function(t,e){q(t.firstChild,{opacity:0,transform:"rotateY("+(e||70)+"deg)"})}},"inner-in":{from:function(t){q(t,"transform","translateX(100%)")},to:function(t){q(t,"transform","translateX(0%)")}},"inner-out":{from:function(t){q(t,"transform","translateX(0%)")},to:function(t){q(t,"transform","translateX(-100%)")}}}),V.fn=V.prototype={constructor:V,getEl:function(t){if(this.el)return N("["+u+'-name="'+t+'"]',this.el)},val:function(t,e){var n="string"==typeof t?this.getEl(t):t;return n&&null==n.value&&(n=C(n,"input")[0]||C(n,"textarea")[0]||C(n,"select")[0]),n&&null!=e&&(n.value=e),n&&n.value||""},toJSON:function(){for(var t,e=this.el.querySelectorAll("["+u+"-name]"),n={},o=e.length;o--;)n[(t=e[o]).getAttribute(u+"-name")]=this.val(t);return n}},W.factory=function(i,n,o){W[i.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")]=function(t,r){var e,a=l.createDocumentFragment();return null!=t||":root"===i?(t=o?t:R(t),_(o?t:t.children,function(t,e){var n=((r||i)+" "+e).replace(/^:\w+\s+/,""),o=J(t)?t:W(n,R(t,e),n);O(a,o)}),o||delete t.children,J(e=n(t,a))||k(e,t),e):a}},W.factory(":default",function(t,e){return t.children=e,t}),W.factory(":root",function(t){return{tag:".ply-form",className:t.mod,children:[W(":header",t.header),W(":content",t.content),t.ctrls&&W(":default",{tag:"div.ply-footer",children:t.ctrls})]}}),W.factory(":header",function(t,e){return{tag:".ply-header",text:t.text,children:e}}),W.factory(":content",function(t,e){return{tag:".ply-content",children:e}},!0),W.factory("ok",function(t){return{ply:":ok",tag:"button.ply-ctrl.ply-ok",text:!0===t?s.ok:t}}),W.factory("cancel",function(t){return{ply:":close",tag:"button.ply-ctrl.ply-cancel",type:"reset",text:!0===t?s.cancel:t}}),M.use=function(t,e,n,o,r){M["_"+t](e,n,o,r)},M("default",function(t,e,n){n(e||{})}),M("base",function(t,e,n){n(U("base",t,e))}),M("alert",function(t,e,n){n(U("alert",t,e,{ok:!0}))}),M("confirm",function(t,e,n){n(U("confirm",t,e,{ok:!0,cancel:!0}))}),M("prompt",function(t,e,n){n(U("prompt",t,e,{ok:!0,cancel:!0}))}),W.factory("dialog-form *",function(t){return{tag:"input.ply-input",type:t.type||"text",name:t.name,value:t.value,required:!0,placeholder:t.hint||t.text}}),H.create=function(t,e,n){return J(t)?E(new H(k(e||{},{el:t}))):(n||(n=e,e={}),(M[t]||M.default)(e,n).then(function(t){return new H(k(e,{el:t}))}))},H.open=function(t,e,n){return H.create(t,e,n).then(function(t){return t.open()})},H.dialog=function(t,p,e){return t instanceof Object&&!J(t)?(p=p||{},g(function(o,r){var a,i,l,n=p.initState,c=t,s={},f=function(t,e){(p.progress||y)(k({name:a.$name,index:a.$index,length:d,stack:c,current:a,widget:e},t),s)},u=function(e,n,o){var t=JSON.parse(JSON.stringify(e.data));l=!0,((a=e).prepare||y)(t,s),H.create(e.ui||"alert",e.options||{},t).then(function(t){(i?i[/^inner/.test(n)?"innerSwap":"swap"](t,n):(i=t).open()).then(function(){s[e.$name].el=i.layerEl,l=!1}),o(i)})},d=0;_(c,function(t,e){n=n||e,t.effects=t.effects||{},t.$name=e,t.$index=d++,s[e]=new H.Context}),c.$length=d,u(c[n],null,function(t){f({},t),i.options.onaction=function(e){if(l)return!1;var t=e.state||"next"===a.back,n=c[a[t?"next":"back"]];if(n)return u(n,a[t?"nextEffect":"backEffect"],function(t){f(e,t)}),!1;(e.state?o:r)(e,s)}})})):(e||J(t)||(e=p||{},p={}),H.open(t,p,e).then(function(n){return g(function(t,e){n.options.onclose=function(){(n.result.state?t:e)(n.result)}})}))},H.ui=W,H.factory=M,H.lang=s,H.css=q,H.cssHooks=$,H.keys=n,H.noop=y,H.each=_,H.extend=k,H.promise=g,H.Promise=v,H.support=f,H.defaults=p,H.attrName=u,H.Context=V,H.dom={build:T,append:O,remove:A,addEvent:B,removeEvent:j},H.version="0.6.1",H});