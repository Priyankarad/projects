function GDouglasPeucker(a,t){var l,r,n,h,e,s,M,g,o,b,f,u,c,w,y,A,i,P,v=Math.PI/180*.5,I=new Array,k=new Array,p=new Array;if(a.length<3)return a;for(l=a.length,o=360*t/(2*Math.PI*6378137),o*=o,p[k[n=0]=0]=l-1,r=1;0<r;)if(h=k[r-1],e=p[r-1],r--,1<e-h){for(b=a[e].lng()-a[h].lng(),f=a[e].lat()-a[h].lat(),180<Math.abs(b)&&(b=360-Math.abs(b)),u=(b*=Math.cos(v*(a[e].lat()+a[h].lat())))*b+f*f,G=h+1,s=h,g=-1;G<e;G++)c=a[G].lng()-a[h].lng(),w=a[G].lat()-a[h].lat(),180<Math.abs(c)&&(c=360-Math.abs(c)),y=(c*=Math.cos(v*(a[G].lat()+a[h].lat())))*c+w*w,A=a[G].lng()-a[e].lng(),i=a[G].lat()-a[e].lat(),180<Math.abs(A)&&(A=360-Math.abs(A)),g<(M=u+(P=(A*=Math.cos(v*(a[G].lat()+a[e].lat())))*A+i*i)<=y?P:u+y<=P?y:(c*f-w*b)*(c*f-w*b)/u)&&(s=G,g=M);g<o?(I[n]=h,n++):(k[++r-1]=s,p[r-1]=e,k[++r-1]=h,p[r-1]=s)}else I[n]=h,n++;I[n]=l-1,n++;for(var D=new Array,G=0;G<n;G++)D.push(a[I[G]]);return D}